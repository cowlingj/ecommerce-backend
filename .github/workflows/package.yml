name: Package

on:
  push:
    branches:
      - master

jobs:
  package:
    name: main
    runs-on: ubuntu-latest
    strategy:
      matrix:
        project:
          - name: cms
            directory: "${GITHUB_WORKSPACE}/cms/main"
    steps:
      - uses: actions/docker/login@master
        env:
          DOCKER_REGISTRY_URL: "docker.pkg.github.com"
          DOCKER_USERNAME: "${{ secrets.GITHUB_DOCKER_USERNAME }}"
          DOCKER_PASSWORD: "${{ secrets.GITHUB_ACCESS_TOKEN }}"
      - uses: actions/checkout@master
      - uses: actions/docker/cli@master
        with:
          args: "build -t ${{ matrix.project.name }} ${{ matrix.project.directory }}"
      - uses: actions/docker/tag@master
        with:
          args: "${{ matrix.project.name }} docker.pkg.github.com/${GITHUB_REPOSITORY}/${{ matrix.project.name }}"
      - uses: actions/docker/cli@master
        with:
          args: "image ls"
      # push to gpr?
