version: 2
jobs:
  build:
    docker:
      - image: docker:19.03.2
    # machine: true
    steps:
      - setup_remote_docker
      - checkout
      - run:
          name: Docker login
          command: echo "$DOCKER_PASS" | docker login --username "$DOCKER_USER" --password-stdin "docker.pkg.github.com"
      - run:
          name: Docker build
          command: docker build -t cms cms/main/
      - run:
          name: Docker tag
          command: docker tag
      - run:
          name: Docker image list
          command: docker image ls
#  - name: "docker login"
#         uses: actions/docker/login@master
#         env:
#           DOCKER_REGISTRY_URL: "docker.pkg.github.com"
#           DOCKER_USERNAME: "${{ secrets.GITHUB_DOCKER_USERNAME }}"
#           DOCKER_PASSWORD: "${{ secrets.GITHUB_ACCESS_TOKEN }}"
#       - name: "git checkout"
#         uses: actions/checkout@master
#       - name: "docker build"
#         uses: actions/docker/cli@master
#         with:
#           args: "build -t ${{ matrix.project.name }} ${{ matrix.project.directory }}"
#       - name: "docker tag"
#         uses: actions/docker/tag@master
#         with:
#           entrypoint: "sh"
#           args: "-c echo ${PATH}; /bin/tag --env-file ${HOME}/tags ${{ matrix.project.name }} docker.pkg.github.com/${GITHUB_REPOSITORY}/${{ matrix.project.name }}"
#       - name: "docker push"
#         uses: actions/docker/cli@master
#         with:
#           entrypoint: "sh"
#           args: >
#             -c
#             env;
#             source ${HOME}/tags;
#             env;
#             docker push
#             docker.pkg.github.com/${GITHUB_REPOSITORY}/${{ matrix.project.name }}:latest
#             docker.pkg.github.com/${GITHUB_REPOSITORY}/${{ matrix.project.name }}:latest
#             docker.pkg.github.com/${GITHUB_REPOSITORY}/${{ matrix.project.name }}:latest
#             docker.pkg.github.com/${GITHUB_REPOSITORY}/${{ matrix.project.name }}:latest
